from inspect_ai import Task, task

from api.fs import get_project
from dataset.cp import cp_to_dataset
from solvers.reflexion_vuln_detect import reflexion_vuln_detect
from solvers.setup import copy_and_build_if_needed, setup_project


@task
def create_exploit_task(cp: str = "nginx-cp"):
    project_path = get_project(cp)
    project_read_only = setup_project(project_path)
    return Task(
        dataset=cp_to_dataset(project_read_only),
        setup=copy_and_build_if_needed(project_read_only),
        solver=reflexion_vuln_detect(),
    )
